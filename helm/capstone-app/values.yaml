# Default values for capstone-app
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

namespace: capstone-app

# ECR Configuration
ecr:
  registry: 954692414134.dkr.ecr.ap-south-1.amazonaws.com
  repository: capstone-repo

# Redis Configuration
redis:
  enabled: true
  image:
    repository: redislabs/redismod
    tag: latest
    pullPolicy: IfNotPresent
  replicas: 1
  service:
    type: ClusterIP
    port: 6379
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# Web Application Configuration
webApp:
  enabled: true
  image:
    tag: latest  # Override with specific version
    pullPolicy: Always
  replicas: 3
  service:
    type: ClusterIP
    port: 80
    targetPort: 5000
  env:
    - name: REDIS_HOST
      value: "redis"
    - name: REDIS_PORT
      value: "6379"
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  livenessProbe:
    enabled: true
    path: /
    initialDelaySeconds: 30
    periodSeconds: 10
  readinessProbe:
    enabled: true
    path: /
    initialDelaySeconds: 10
    periodSeconds: 5

# NGINX Configuration
nginx:
  enabled: true
  image:
    tag: latest  # Override with specific version
    pullPolicy: Always
  replicas: 2
  service:
    type: LoadBalancer
    port: 80
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
  resources:
    requests:
      cpu: 100m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi
  config: |
    events {
      worker_connections 1024;
    }
    
    http {
      upstream backend {
        server web-app-service:80;
      }
      
      server {
        listen 80;
        server_name _;
        
        location / {
          proxy_pass http://backend;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        location /health {
          access_log off;
          return 200 "healthy\n";
          add_header Content-Type text/plain;
        }
      }
    }

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Ingress (optional - for ALB)
ingress:
  enabled: false
  className: alb
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
  host: ""
